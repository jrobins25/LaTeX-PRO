import { __awaiter } from "tslib";
import { EditorView, Decoration, WidgetType } from "@codemirror/view";
import { RangeSetBuilder, StateField, StateEffect } from "@codemirror/state";
export function displayInlinePlaceholder(view, placeholders) {
    const placeholderField = StateField.define({
        create() { return placeholders; },
        update(deco, tr) { return deco.map(tr.changes); },
        provide: f => EditorView.decorations.from(f)
    });
    view.dispatch({
        effects: StateEffect.appendConfig.of([placeholderField])
    });
}
export function decorateInlineTags(view, ranges) {
    const builder = new RangeSetBuilder();
    for (const range of ranges) {
        // extract text for most up-to-date data
        const text = view.state.doc.sliceString(range.start, range.end);
        const startMatch = text.match(/^\$latexPro:/);
        const endMatch = text.match(/\$$/);
        if (startMatch) {
            const startFrom = range.start;
            const startTo = range.start + startMatch[0].length;
            const markStart = Decoration.mark({ class: "latexPro-inline-tag-marker" });
        }
        if (endMatch) {
            const endTo = range.end;
            const endFrom = range.end - endMatch[0].length;
            const markEnd = Decoration.mark({ class: "latexPro-inline-tag-marker" });
        }
        const mark = Decoration.mark({ class: "latexPro-inline-tag-decoration" });
        builder.add(range.start, range.end, mark);
    }
    const decoSet = builder.finish();
    const field = StateField.define({
        create() { return decoSet; },
        update(deco, tr) { return deco.map(tr.changes); },
        provide: f => EditorView.decorations.from(f)
    });
    view.dispatch({ effects: StateEffect.appendConfig.of([field]) });
}
class latexProInlinePlaceholder extends WidgetType {
    toDOM() {
        const span = document.createElement("span");
        span.className = "latexPro-inline-placeholder";
        span.style.display = "inline-block"; // this ensures width of text is taken
        span.style.position = "relative"; // allow positioning over text
        span.style.backgroundColor = "rgba(255,255,0,0.2)";
        span.style.pointerEvents = "none";
        span.style.padding = "0 2px"; // small padding around tag
        span.style.borderRadius = "2px";
        // span.textContent = "â³";
        span.textContent = "test";
        return span;
    }
    ignoreEvent() {
        // makes it so the span ignores any mouseclicks etc
        return true;
    }
}
export function createInlinePlaceholder(view, tags) {
    const builder = new RangeSetBuilder();
    // performance wise the body of for loop is not costly
    for (const tag of tags) {
        const widget = Decoration.widget({
            widget: new latexProInlinePlaceholder(),
            side: 1 // means the insertion is after the symbol specified in builder.add
        });
        // puts widget at end of dollar symbol
        builder.add(tag.end, tag.end, widget);
    }
    return builder.finish();
}
export function getInlineLatexTagsInEditor(markdown) {
    return __awaiter(this, void 0, void 0, function* () {
        // will store tag content and positions in document at each entry
        const tags = [];
        const inlineTagRegex = /\$latexPro:([\s\S]+?)\$/g;
        let match;
        while ((match = inlineTagRegex.exec(markdown)) !== null) {
            const start = match.index;
            const end = match.index + match[0].length;
            const content = match[1].trim();
            tags.push({ start, end, content });
        }
        return tags;
    });
}
// makes output of tags tidy for console logging
export function formatLatexTagsForPrint(tags) {
    return tags
        .map(tag => `start ${tag.start} end ${tag.end} content ${tag.content}`)
        .join("\n");
}
// grabs the markdown content of active file, returns as string.
export function grabActiveFileContent(app) {
    return __awaiter(this, void 0, void 0, function* () {
        const file = app.workspace.getActiveFile();
        if (!file) {
            return null;
        }
        const content = yield app.vault.read(file);
        return content;
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRQb3N0UHJvY2Vzc2luZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1kUG9zdFByb2Nlc3NpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUtBLE9BQU8sRUFBQyxVQUFVLEVBQUUsVUFBVSxFQUFpQixVQUFVLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQztBQUNuRixPQUFPLEVBQUUsZUFBZSxFQUFZLFVBQVUsRUFBRSxXQUFXLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUd0RixNQUFNLFVBQVUsd0JBQXdCLENBQ3BDLElBQWlCLEVBQ2pCLFlBQWtDO0lBRTlCLE1BQU0sZ0JBQWdCLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBZ0I7UUFDdEQsTUFBTSxLQUFHLE9BQU8sWUFBWSxDQUFDLENBQUEsQ0FBQztRQUM5QixNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBRSxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFBLENBQUEsQ0FBQztRQUM3QyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7S0FDL0MsQ0FBQyxDQUFBO0lBRUYsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNWLE9BQU8sRUFBRSxXQUFXLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUM7S0FDM0QsQ0FBQyxDQUFBO0FBQ04sQ0FBQztBQUVMLE1BQU0sVUFBVSxrQkFBa0IsQ0FDOUIsSUFBZ0IsRUFDaEIsTUFBc0M7SUFFbEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxlQUFlLEVBQWMsQ0FBQztJQUVsRCxLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sRUFBQztRQUN2Qix3Q0FBd0M7UUFFeEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FB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QyxJQUF1RDtJQUV2RCxPQUFPLElBQUk7U0FDUixHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxLQUFLLFFBQVEsR0FBRyxDQUFDLEdBQUcsWUFBWSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDdEUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2hCLENBQUM7QUFFRCxnRUFBZ0U7QUFDaEUsTUFBTSxVQUFnQixxQkFBcUIsQ0FBQyxHQUFROztRQUNoRCxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzNDLElBQUksQ0FBQyxJQUFJLEVBQUM7WUFDTixPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsTUFBTSxPQUFPLEdBQUcsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxPQUFPLE9BQU8sQ0FBQTtJQUNsQixDQUFDO0NBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG5tZFBvc3RQcm9jZXNzaW5nLnRzXHJcbiAgICBoZWxwZXIgZnVuY3Rpb25zIGFzc29jaWF0ZWQgd2l0aCBwcm9jZXNzaW5nIGVkaXQgJiByZWFkIG1vZGUgb2YgbWFya2Rvd24gZmlsZXMgaW4gb2JzaWRpYW5cclxuKi9cclxuaW1wb3J0IHsgQXBwIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQge0VkaXRvclZpZXcsIERlY29yYXRpb24sIERlY29yYXRpb25TZXQgLFdpZGdldFR5cGV9IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XHJcbmltcG9ydCB7IFJhbmdlU2V0QnVpbGRlciwgUmFuZ2VTZXQsIFN0YXRlRmllbGQsIFN0YXRlRWZmZWN0fSBmcm9tIFwiQGNvZGVtaXJyb3Ivc3RhdGVcIjtcclxuaW1wb3J0IGxhdGV4UHJvIGZyb20gJ21haW4nO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRpc3BsYXlJbmxpbmVQbGFjZWhvbGRlcihcclxuICAgIHZpZXcgOiBFZGl0b3JWaWV3LFxyXG4gICAgcGxhY2Vob2xkZXJzOiBSYW5nZVNldDxEZWNvcmF0aW9uPlxyXG4gICAgKXtcclxuICAgICAgICBjb25zdCBwbGFjZWhvbGRlckZpZWxkID0gU3RhdGVGaWVsZC5kZWZpbmU8RGVjb3JhdGlvblNldD4oe1xyXG4gICAgICAgICAgICBjcmVhdGUoKXtyZXR1cm4gcGxhY2Vob2xkZXJzO30sXHJcbiAgICAgICAgICAgIHVwZGF0ZShkZWNvLCB0cil7cmV0dXJuIGRlY28ubWFwKHRyLmNoYW5nZXMpfSwgLy8gb25seSBwb3NpdGlvbiB0cmFja2luZzogbm8gZGVib3VuY2UgbmVlZGVkXHJcbiAgICAgICAgICAgIHByb3ZpZGU6IGYgPT4gRWRpdG9yVmlldy5kZWNvcmF0aW9ucy5mcm9tKGYpXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgdmlldy5kaXNwYXRjaCh7XHJcbiAgICAgICAgICAgIGVmZmVjdHM6IFN0YXRlRWZmZWN0LmFwcGVuZENvbmZpZy5vZihbcGxhY2Vob2xkZXJGaWVsZF0pXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWNvcmF0ZUlubGluZVRhZ3MoXHJcbiAgICB2aWV3OiBFZGl0b3JWaWV3LFxyXG4gICAgcmFuZ2VzOiB7c3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXJ9W11cclxuICAgICl7XHJcbiAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8RGVjb3JhdGlvbj4oKTtcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiByYW5nZXMpe1xyXG4gICAgICAgICAgICAvLyBleHRyYWN0IHRleHQgZm9yIG1vc3QgdXAtdG8tZGF0ZSBkYXRhXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCB0ZXh0ID0gdmlldy5zdGF0ZS5kb2Muc2xpY2VTdHJpbmcocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZClcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0TWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eXFwkbGF0ZXhQcm86LylcclxuICAgICAgICAgICAgY29uc3QgZW5kTWF0Y2ggPSB0ZXh0Lm1hdGNoKC9cXCQkLylcclxuXHJcbiAgICAgICAgICAgIGlmIChzdGFydE1hdGNoKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RnJvbSA9IHJhbmdlLnN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRUbyA9IHJhbmdlLnN0YXJ0ICsgc3RhcnRNYXRjaFswXS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXJrU3RhcnQgPSBEZWNvcmF0aW9uLm1hcmsoe2NsYXNzOiBcImxhdGV4UHJvLWlubGluZS10YWctbWFya2VyXCJ9KVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZW5kTWF0Y2gpe1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZW5kVG8gPSByYW5nZS5lbmQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlbmRGcm9tID0gcmFuZ2UuZW5kIC0gZW5kTWF0Y2hbMF0ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWFya0VuZCA9IERlY29yYXRpb24ubWFyayh7Y2xhc3M6IFwibGF0ZXhQcm8taW5saW5lLXRhZy1tYXJrZXJcIn0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBjb25zdCBtYXJrID0gRGVjb3JhdGlvbi5tYXJrKHtjbGFzczpcImxhdGV4UHJvLWlubGluZS10YWctZGVjb3JhdGlvblwifSlcclxuXHJcbiAgICAgICAgICAgIGJ1aWxkZXIuYWRkKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQsIG1hcmspO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGVjb1NldCA9IGJ1aWxkZXIuZmluaXNoKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGZpZWxkID0gU3RhdGVGaWVsZC5kZWZpbmU8RGVjb3JhdGlvblNldD4oe1xyXG4gICAgICAgICAgICBjcmVhdGUoKXtyZXR1cm4gZGVjb1NldH0sXHJcbiAgICAgICAgICAgIHVwZGF0ZShkZWNvLCB0cil7cmV0dXJuIGRlY28ubWFwKHRyLmNoYW5nZXMpfSxcclxuICAgICAgICAgICAgcHJvdmlkZTogZiA9PiBFZGl0b3JWaWV3LmRlY29yYXRpb25zLmZyb20oZilcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICB2aWV3LmRpc3BhdGNoKHtlZmZlY3RzOiBTdGF0ZUVmZmVjdC5hcHBlbmRDb25maWcub2YoW2ZpZWxkXSl9KVxyXG4gICAgfVxyXG5cclxuY2xhc3MgbGF0ZXhQcm9JbmxpbmVQbGFjZWhvbGRlciBleHRlbmRzIFdpZGdldFR5cGV7XHJcbiAgICB0b0RPTSgpIHtcclxuICAgICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgc3Bhbi5jbGFzc05hbWUgPVwibGF0ZXhQcm8taW5saW5lLXBsYWNlaG9sZGVyXCI7XHJcblxyXG4gICAgICAgIHNwYW4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCIgLy8gdGhpcyBlbnN1cmVzIHdpZHRoIG9mIHRleHQgaXMgdGFrZW5cclxuICAgICAgICBzcGFuLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiOyAvLyBhbGxvdyBwb3NpdGlvbmluZyBvdmVyIHRleHRcclxuICAgICAgICBzcGFuLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiYSgyNTUsMjU1LDAsMC4yKVwiO1xyXG4gICAgICAgIHNwYW4uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xyXG4gICAgICAgIHNwYW4uc3R5bGUucGFkZGluZyA9IFwiMCAycHhcIiAvLyBzbWFsbCBwYWRkaW5nIGFyb3VuZCB0YWdcclxuICAgICAgICBzcGFuLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiMnB4XCJcclxuXHJcbiAgICAgICAgLy8gc3Bhbi50ZXh0Q29udGVudCA9IFwi4o+zXCI7XHJcbiAgICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IFwidGVzdFwiO1xyXG5cclxuICAgICAgICByZXR1cm4gc3BhbjtcclxuICAgIH1cclxuICAgIGlnbm9yZUV2ZW50KCl7XHJcbiAgICAgICAgLy8gbWFrZXMgaXQgc28gdGhlIHNwYW4gaWdub3JlcyBhbnkgbW91c2VjbGlja3MgZXRjXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbmxpbmVQbGFjZWhvbGRlcihcclxuICAgIHZpZXc6IEVkaXRvclZpZXcsXHJcbiAgICB0YWdzOiB7c3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXJ9W11cclxuICAgICl7XHJcbiAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8RGVjb3JhdGlvbj4oKTtcclxuXHJcbiAgICAgICAgLy8gcGVyZm9ybWFuY2Ugd2lzZSB0aGUgYm9keSBvZiBmb3IgbG9vcCBpcyBub3QgY29zdGx5XHJcbiAgICAgICAgZm9yIChjb25zdCB0YWcgb2YgdGFncyl7XHJcbiAgICAgICAgICAgIGNvbnN0IHdpZGdldCA9IERlY29yYXRpb24ud2lkZ2V0KHtcclxuICAgICAgICAgICAgICAgIHdpZGdldDogbmV3IGxhdGV4UHJvSW5saW5lUGxhY2Vob2xkZXIoKSxcclxuICAgICAgICAgICAgICAgIHNpZGUgOiAxIC8vIG1lYW5zIHRoZSBpbnNlcnRpb24gaXMgYWZ0ZXIgdGhlIHN5bWJvbCBzcGVjaWZpZWQgaW4gYnVpbGRlci5hZGRcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLy8gcHV0cyB3aWRnZXQgYXQgZW5kIG9mIGRvbGxhciBzeW1ib2xcclxuICAgICAgICAgICAgYnVpbGRlci5hZGQodGFnLmVuZCx0YWcuZW5kLHdpZGdldClcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuZmluaXNoKCk7XHJcbiAgICB9XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SW5saW5lTGF0ZXhUYWdzSW5FZGl0b3IobWFya2Rvd246IHN0cmluZyl7XHJcbiAgICAvLyB3aWxsIHN0b3JlIHRhZyBjb250ZW50IGFuZCBwb3NpdGlvbnMgaW4gZG9jdW1lbnQgYXQgZWFjaCBlbnRyeVxyXG4gICAgY29uc3QgdGFnczoge3N0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyOyBjb250ZW50OiBzdHJpbmd9W109W11cclxuXHJcbiAgICBjb25zdCBpbmxpbmVUYWdSZWdleCA9IC9cXCRsYXRleFBybzooW1xcc1xcU10rPylcXCQvZ1xyXG5cclxuICAgIGxldCBtYXRjaDogUmVnRXhwRXhlY0FycmF5IHwgbnVsbDsgXHJcblxyXG4gICAgd2hpbGUgKChtYXRjaD1pbmxpbmVUYWdSZWdleC5leGVjKG1hcmtkb3duKSkhPT0gbnVsbCl7XHJcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBtYXRjaC5pbmRleDtcclxuICAgICAgICBjb25zdCBlbmQgPSBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aFxyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBtYXRjaFsxXS50cmltKCk7XHJcblxyXG4gICAgICAgIHRhZ3MucHVzaCh7c3RhcnQsIGVuZCwgY29udGVudH0pXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRhZ3NcclxufVxyXG5cclxuLy8gbWFrZXMgb3V0cHV0IG9mIHRhZ3MgdGlkeSBmb3IgY29uc29sZSBsb2dnaW5nXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRMYXRleFRhZ3NGb3JQcmludChcclxuICB0YWdzOiB7IHN0YXJ0OiBudW1iZXI7IGVuZDogbnVtYmVyOyBjb250ZW50OiBzdHJpbmcgfVtdXHJcbik6IHN0cmluZyB7XHJcbiAgcmV0dXJuIHRhZ3NcclxuICAgIC5tYXAodGFnID0+IGBzdGFydCAke3RhZy5zdGFydH0gZW5kICR7dGFnLmVuZH0gY29udGVudCAke3RhZy5jb250ZW50fWApXHJcbiAgICAuam9pbihcIlxcblwiKTtcclxufVxyXG5cclxuLy8gZ3JhYnMgdGhlIG1hcmtkb3duIGNvbnRlbnQgb2YgYWN0aXZlIGZpbGUsIHJldHVybnMgYXMgc3RyaW5nLlxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ3JhYkFjdGl2ZUZpbGVDb250ZW50KGFwcDogQXBwKXtcclxuICAgIGNvbnN0IGZpbGUgPSBhcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuICAgIGlmICghZmlsZSl7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgYXBwLnZhdWx0LnJlYWQoZmlsZSk7XHJcbiAgICByZXR1cm4gY29udGVudFxyXG59XHJcblxyXG4iXX0=